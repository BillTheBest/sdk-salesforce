/// <reference path="../../typings/index.d.ts" />
/// <reference path="../interfaces/ITilesProps.ts" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var Panels = (function (_super) {
    __extends(Panels, _super);
    function Panels(props) {
        _super.call(this, props);
        this.onSelect = this.onSelect.bind(this);
        this.onOutcome = this.onOutcome.bind(this);
        this.onNext = this.onNext.bind(this);
        this.onPrev = this.onPrev.bind(this);
        this.renderItem = this.renderItem.bind(this);
        this.onSearch = this.onSearch.bind(this);
    }
    Panels.prototype.onSelect = function (e) {
        this.props.select(e.currentTarget.id);
    };
    Panels.prototype.onOutcome = function (e) {
        this.props.onOutcome(e.currentTarget.parentElement.parentElement.id, e.currentTarget.id);
    };
    Panels.prototype.onPrev = function () {
        var _this = this;
        this.props.onPrev();
        setTimeout(function () { return _this.refs['container'].scrollIntoView(true); });
    };
    Panels.prototype.onNext = function () {
        var _this = this;
        this.props.onNext();
        setTimeout(function () { return _this.refs['container'].scrollIntoView(true); });
    };
    Panels.prototype.onSearch = function (search, clearSelection) {
        this.props.onSearch(search, clearSelection);
    };
    Panels.prototype.renderItem = function (item, columns, outcomes, deleteOutcome) {
        if (item.type === 'next')
            return React.createElement("div", {className: "mw-tiles-next", onClick: this.onNext}, React.createElement("span", {className: "glyphicon glyphicon-arrow-right"}));
        if (item.type === 'prev')
            return React.createElement("div", {className: "mw-tiles-prev", onClick: this.onPrev}, React.createElement("span", {className: "glyphicon glyphicon-arrow-left"}));
        var className = 'mw-tiles-item';
        if (item.isSelected)
            className += ' bg-info';
        var header = item.properties.find(function (property) { return property.typeElementPropertyId == columns[0].typeElementPropertyId; }).contentValue;
        var deleteOutcomeElement = null;
        if (deleteOutcome)
            deleteOutcomeElement = React.createElement(manywho.component.getByName('outcome'), { id: deleteOutcome.id, flowKey: this.props.flowKey, onClick: this.onOutcome, size: 'sm' });
        var content = null;
        if (columns.length > 1)
            content = item.properties.find(function (property) { return property.typeElementPropertyId == columns[1].typeElementPropertyId; }).contentValue;
        var footer = null;
        if (columns.length > 2)
            footer = columns.map(function (column, index) {
                if (index > 1) {
                    var property = item.properties.find(function (property) { return property.typeElementPropertyId == column.typeElementPropertyId; });
                    return React.createElement("li", null, React.createElement("strong", null, property.developerName), ": ", property.contentValue);
                }
            });
        return (React.createElement("div", {className: className, onClick: this.onSelect, id: item.externalId}, React.createElement("div", {className: "mw-tiles-item-header"}, React.createElement("h4", {title: header}, header), deleteOutcomeElement), React.createElement("div", {className: "mw-tiles-item-content"}, content), React.createElement("ul", {className: "mw-tiles-item-footer list-unstyled"}, footer), React.createElement("div", {className: "mw-tiles-item-outcomes"}, outcomes)));
    };
    Panels.prototype.render = function () {
        var _this = this;
        manywho.log.info('Rendering Tiles: ' + this.props.id);
        if (this.props.isDesignTime)
            return null;
        var model = manywho.model.getComponent(this.props.id, this.props.flowKey);
        var state = this.props.isDesignTime ? { error: null, loading: false } : manywho.state.getComponent(this.props.id, this.props.flowKey) || {};
        var outcomes = manywho.model.getOutcomes(this.props.id, this.props.flowKey);
        var columns = manywho.component.getDisplayColumns(model.columns) || [];
        var className = manywho.styling.getClasses(this.props.parentId, this.props.id, "tiles", this.props.flowKey).join(' ');
        if (model.isVisible == false)
            className += ' hidden';
        var labelElement = null;
        if (!manywho.utils.isNullOrWhitespace(model.label))
            labelElement = React.createElement("label", null, model.label);
        var headerElement = React.createElement(manywho.component.getByName('mw-items-header'), {
            flowKey: this.props.flowKey,
            isSearchable: model.isSearchable,
            isRefreshable: (model.objectDataRequest || model.fileDataRequest),
            onSearch: this.onSearch,
            outcomes: manywho.model.getOutcomes(this.props.id, this.props.flowKey),
            refresh: this.props.refresh
        });
        var footerOutcomes = outcomes && outcomes
            .filter(function (outcome) { return !manywho.utils.isEqual(outcome.pageActionType, 'Delete', true) && !outcome.isBulkAction; })
            .map(function (outcome) { return React.createElement(manywho.component.getByName('outcome'), { id: outcome.id, flowKey: _this.props.flowKey, onClick: _this.onOutcome, size: 'default' }); });
        var deleteOutcome = outcomes && outcomes
            .filter(function (outcome) { return manywho.utils.isEqual(outcome.pageActionType, 'Delete', true) && !outcome.isBulkAction; })[0];
        var contentElement = null;
        var items = [];
        if (this.props.objectData && !manywho.utils.isPlaceholderObjectData(this.props.objectData)) {
            items = this.props.objectData.map(function (item) { return item; });
            if (this.props.page > 1)
                items.unshift({ type: 'prev' });
            if (this.props.hasMoreResults === true)
                items = items.concat([{ type: 'next' }]);
        }
        if (this.props.contentElement)
            contentElement = this.props.contentElement;
        else {
            contentElement = (React.createElement("div", {className: "mw-tiles-items"}, items.map(function (item, index) {
                var key = _this.props.page.toString() + "-" + index;
                return (React.createElement("div", {className: "mw-tiles-item-container", key: key, ref: "items"}, React.createElement(ReactMotion.Motion, {defaultStyle: { rotate: 0 }, style: { rotate: ReactMotion.spring(180, { stiffness: 65, damping: 9.5 }) }}, function (interpolatingStyle) {
                    var frontTransform = "rotateY(" + interpolatingStyle.rotate + "deg)";
                    var backTransform = "rotateY(" + (180 - interpolatingStyle.rotate) + "deg)";
                    return (React.createElement("div", null, React.createElement("div", {className: "front", style: { transform: frontTransform }}), React.createElement("div", {className: "back", style: { transform: backTransform }}, _this.renderItem(item, columns, footerOutcomes, deleteOutcome))));
                })));
            })));
        }
        return (React.createElement("div", {className: className, id: this.props.id, ref: "container"}, labelElement, headerElement, contentElement, React.createElement(manywho.component.getByName('wait'), { isVisible: state.loading, message: state.loading && state.loading.message }, null)));
    };
    return Panels;
}(React.Component));
manywho.component.registerItems('panels', Panels);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvcGFuZWxzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7QUFDakQscURBQXFEOzs7Ozs7QUFLckQ7SUFBcUIsMEJBQWlDO0lBRWxELGdCQUFZLEtBQWtCO1FBQzFCLGtCQUFNLEtBQUssQ0FBQyxDQUFDO1FBRWIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELHlCQUFRLEdBQVIsVUFBUyxDQUFDO1FBQ04sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsMEJBQVMsR0FBVCxVQUFVLENBQUM7UUFDUCxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0YsQ0FBQztJQUVELHVCQUFNLEdBQU47UUFBQSxpQkFHQztRQUZHLElB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QUNMLENBQUMsQ0FBQztRQUNaLENBQUM7UUFFRCxNQUFNLENBQUMsQ0FBQyxxQkFBQyxHQUFHLElBQUMsU0FBUyxFQUFFLFNBQVUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFHLEVBQUMsR0FBRyxFQUFDLFdBQVcsR0FDaEUsWUFBYSxFQUNiLGFBQWMsRUFDZCxjQUFlLEVBQ2YsS0FBSyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxDQUFFLENBQzdJLENBQUMsQ0FBQztJQUNaLENBQUM7SUFFTCxhQUFDO0FBQUQsQ0E3SkEsQUE2SkMsQ0E3Sm9CLEtBQUssQ0FBQyxTQUFTLEdBNkpuQztBQUVELE9BQU8sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQyIsImZpbGUiOiJjb21wb25lbnRzL3BhbmVscy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2ludGVyZmFjZXMvSVRpbGVzUHJvcHMudHNcIiAvPlxuXG5kZWNsYXJlIHZhciBtYW55d2hvOiBhbnk7XG5kZWNsYXJlIHZhciBSZWFjdE1vdGlvbjogYW55O1xuXG5jbGFzcyBQYW5lbHMgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8SVRpbGVzUHJvcHMsIGFueT4ge1xuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IElUaWxlc1Byb3BzKXtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIHRoaXMub25TZWxlY3QgPSB0aGlzLm9uU2VsZWN0LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMub25PdXRjb21lID0gdGhpcy5vbk91dGNvbWUuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5vbk5leHQgPSB0aGlzLm9uTmV4dC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uUHJldiA9IHRoaXMub25QcmV2LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMucmVuZGVySXRlbSA9IHRoaXMucmVuZGVySXRlbS5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uU2VhcmNoID0gdGhpcy5vblNlYXJjaC5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIG9uU2VsZWN0KGUpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5zZWxlY3QoZS5jdXJyZW50VGFyZ2V0LmlkKTtcbiAgICB9XG5cbiAgICBvbk91dGNvbWUoZSkge1xuICAgICAgICB0aGlzLnByb3BzLm9uT3V0Y29tZShlLmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmlkLCBlLmN1cnJlbnRUYXJnZXQuaWQpO1xuICAgIH1cblxuICAgIG9uUHJldigpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblByZXYoKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAodGhpcy5yZWZzWydjb250YWluZXInXSBhcyBIVE1MRWxlbWVudCkuc2Nyb2xsSW50b1ZpZXcodHJ1ZSkpO1xuICAgIH1cblxuICAgIG9uTmV4dCgpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbk5leHQoKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAodGhpcy5yZWZzWydjb250YWluZXInXSBhcyBIVE1MRWxlbWVudCkuc2Nyb2xsSW50b1ZpZXcodHJ1ZSkpO1xuICAgIH1cblxuICAgIG9uU2VhcmNoKHNlYXJjaDogc3RyaW5nLCBjbGVhclNlbGVjdGlvbiA6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblNlYXJjaChzZWFyY2gsIGNsZWFyU2VsZWN0aW9uKTtcbiAgICB9XG5cbiAgICByZW5kZXJJdGVtKGl0ZW06IGFueSwgY29sdW1uczogQXJyYXk8YW55Piwgb3V0Y29tZXM6IEFycmF5PGFueT4sIGRlbGV0ZU91dGNvbWU6IGFueSkgOiBKU1guRWxlbWVudCB7XG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICduZXh0JylcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm13LXRpbGVzLW5leHRcIiBvbkNsaWNrPXt0aGlzLm9uTmV4dH0+PHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy1yaWdodFwiLz48L2Rpdj47XG5cbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ3ByZXYnKVxuICAgICAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibXctdGlsZXMtcHJldlwiIG9uQ2xpY2s9e3RoaXMub25QcmV2fT48c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LWxlZnRcIi8+PC9kaXY+O1xuXG4gICAgICAgIGxldCBjbGFzc05hbWUgPSAnbXctdGlsZXMtaXRlbSc7XG4gICAgICAgIGlmIChpdGVtLmlzU2VsZWN0ZWQpXG4gICAgICAgICAgICBjbGFzc05hbWUgKz0gJyBiZy1pbmZvJztcblxuICAgICAgICBjb25zdCBoZWFkZXI6IHN0cmluZyA9IGl0ZW0ucHJvcGVydGllcy5maW5kKChwcm9wZXJ0eSkgPT4gcHJvcGVydHkudHlwZUVsZW1lbnRQcm9wZXJ0eUlkID09IGNvbHVtbnNbMF0udHlwZUVsZW1lbnRQcm9wZXJ0eUlkKS5jb250ZW50VmFsdWU7XG5cbiAgICAgICAgbGV0IGRlbGV0ZU91dGNvbWVFbGVtZW50ID0gbnVsbDtcbiAgICAgICAgaWYgKGRlbGV0ZU91dGNvbWUpXG4gICAgICAgICAgICBkZWxldGVPdXRjb21lRWxlbWVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQobWFueXdoby5jb21wb25lbnQuZ2V0QnlOYW1lKCdvdXRjb21lJyksIHsgaWQ6IGRlbGV0ZU91dGNvbWUuaWQsIGZsb3dLZXk6IHRoaXMucHJvcHMuZmxvd0tleSwgb25DbGljazogdGhpcy5vbk91dGNvbWUsIHNpemU6ICdzbScgfSk7XG5cbiAgICAgICAgbGV0IGNvbnRlbnQ6IHN0cmluZyA9IG51bGw7XG4gICAgICAgIGlmIChjb2x1bW5zLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICBjb250ZW50ID0gaXRlbS5wcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5KSA9PiBwcm9wZXJ0eS50eXBlRWxlbWVudFByb3BlcnR5SWQgPT0gY29sdW1uc1sxXS50eXBlRWxlbWVudFByb3BlcnR5SWQpLmNvbnRlbnRWYWx1ZTtcblxuICAgICAgICBsZXQgZm9vdGVyOiBBcnJheTxKU1guRWxlbWVudD4gPSBudWxsO1xuICAgICAgICBpZiAoY29sdW1ucy5sZW5ndGggPiAyKVxuICAgICAgICAgICAgZm9vdGVyID0gY29sdW1ucy5tYXAoKGNvbHVtbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gaXRlbS5wcm9wZXJ0aWVzLmZpbmQoKHByb3BlcnR5KSA9PiBwcm9wZXJ0eS50eXBlRWxlbWVudFByb3BlcnR5SWQgPT0gY29sdW1uLnR5cGVFbGVtZW50UHJvcGVydHlJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8bGk+PHN0cm9uZz57cHJvcGVydHkuZGV2ZWxvcGVyTmFtZX08L3N0cm9uZz46IHtwcm9wZXJ0eS5jb250ZW50VmFsdWV9PC9saT5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gKDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMub25TZWxlY3R9IGlkPXtpdGVtLmV4dGVybmFsSWR9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdy10aWxlcy1pdGVtLWhlYWRlclwiPlxuICAgICAgICAgICAgICAgIDxoNCB0aXRsZT17aGVhZGVyfT57aGVhZGVyfTwvaDQ+XG4gICAgICAgICAgICAgICAge2RlbGV0ZU91dGNvbWVFbGVtZW50fVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm13LXRpbGVzLWl0ZW0tY29udGVudFwiPntjb250ZW50fTwvZGl2PlxuICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT1cIm13LXRpbGVzLWl0ZW0tZm9vdGVyIGxpc3QtdW5zdHlsZWRcIj57Zm9vdGVyfTwvdWw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm13LXRpbGVzLWl0ZW0tb3V0Y29tZXNcIj57b3V0Y29tZXN9PC9kaXY+XG4gICAgICAgIDwvZGl2Pik7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBtYW55d2hvLmxvZy5pbmZvKCdSZW5kZXJpbmcgVGlsZXM6ICcgKyB0aGlzLnByb3BzLmlkKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pc0Rlc2lnblRpbWUpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBjb25zdCBtb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMucHJvcHMuaWQsIHRoaXMucHJvcHMuZmxvd0tleSk7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5wcm9wcy5pc0Rlc2lnblRpbWUgPyB7IGVycm9yOiBudWxsLCBsb2FkaW5nOiBmYWxzZSB9IDogbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgdGhpcy5wcm9wcy5mbG93S2V5KSB8fCB7fTtcbiAgICAgICAgY29uc3Qgb3V0Y29tZXM6IGFueSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5wcm9wcy5pZCwgdGhpcy5wcm9wcy5mbG93S2V5KTtcbiAgICAgICAgY29uc3QgY29sdW1uczogQXJyYXk8YW55PiA9IG1hbnl3aG8uY29tcG9uZW50LmdldERpc3BsYXlDb2x1bW5zKG1vZGVsLmNvbHVtbnMpIHx8IFtdO1xuXG4gICAgICAgIGxldCBjbGFzc05hbWUgPSBtYW55d2hvLnN0eWxpbmcuZ2V0Q2xhc3Nlcyh0aGlzLnByb3BzLnBhcmVudElkLCB0aGlzLnByb3BzLmlkLCBcInRpbGVzXCIsIHRoaXMucHJvcHMuZmxvd0tleSkuam9pbignICcpO1xuXG4gICAgICAgIGlmIChtb2RlbC5pc1Zpc2libGUgPT0gZmFsc2UpXG4gICAgICAgICAgICBjbGFzc05hbWUgKz0gJyBoaWRkZW4nO1xuXG4gICAgICAgIGxldCBsYWJlbEVsZW1lbnQgPSBudWxsO1xuICAgICAgICBpZiAoIW1hbnl3aG8udXRpbHMuaXNOdWxsT3JXaGl0ZXNwYWNlKG1vZGVsLmxhYmVsKSlcbiAgICAgICAgICAgIGxhYmVsRWxlbWVudCA9IDxsYWJlbD57bW9kZWwubGFiZWx9PC9sYWJlbD47XG5cbiAgICAgICAgY29uc3QgaGVhZGVyRWxlbWVudCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQobWFueXdoby5jb21wb25lbnQuZ2V0QnlOYW1lKCdtdy1pdGVtcy1oZWFkZXInKSwge1xuICAgICAgICAgICAgZmxvd0tleTogdGhpcy5wcm9wcy5mbG93S2V5LFxuICAgICAgICAgICAgaXNTZWFyY2hhYmxlOiBtb2RlbC5pc1NlYXJjaGFibGUsXG4gICAgICAgICAgICBpc1JlZnJlc2hhYmxlOiAobW9kZWwub2JqZWN0RGF0YVJlcXVlc3QgfHwgbW9kZWwuZmlsZURhdGFSZXF1ZXN0KSxcbiAgICAgICAgICAgIG9uU2VhcmNoOiB0aGlzLm9uU2VhcmNoLFxuICAgICAgICAgICAgb3V0Y29tZXM6IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5wcm9wcy5pZCwgdGhpcy5wcm9wcy5mbG93S2V5KSxcbiAgICAgICAgICAgIHJlZnJlc2g6IHRoaXMucHJvcHMucmVmcmVzaFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmb290ZXJPdXRjb21lczogQXJyYXk8SlNYLkVsZW1lbnQ+ID0gb3V0Y29tZXMgJiYgb3V0Y29tZXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChvdXRjb21lKSA9PiAhbWFueXdoby51dGlscy5pc0VxdWFsKG91dGNvbWUucGFnZUFjdGlvblR5cGUsICdEZWxldGUnLCB0cnVlKSAmJiAhb3V0Y29tZS5pc0J1bGtBY3Rpb24pXG4gICAgICAgICAgICAgICAgLm1hcCgob3V0Y29tZSkgPT4gUmVhY3QuY3JlYXRlRWxlbWVudChtYW55d2hvLmNvbXBvbmVudC5nZXRCeU5hbWUoJ291dGNvbWUnKSwgeyBpZDogb3V0Y29tZS5pZCwgZmxvd0tleTogdGhpcy5wcm9wcy5mbG93S2V5LCBvbkNsaWNrOiB0aGlzLm9uT3V0Y29tZSwgc2l6ZTogJ2RlZmF1bHQnIH0pKTtcblxuICAgICAgICBjb25zdCBkZWxldGVPdXRjb21lOiBhbnkgPSBvdXRjb21lcyAmJiBvdXRjb21lc1xuICAgICAgICAgICAgICAgIC5maWx0ZXIoKG91dGNvbWUpID0+IG1hbnl3aG8udXRpbHMuaXNFcXVhbChvdXRjb21lLnBhZ2VBY3Rpb25UeXBlLCAnRGVsZXRlJywgdHJ1ZSkgJiYgIW91dGNvbWUuaXNCdWxrQWN0aW9uKVswXTtcblxuICAgICAgICBsZXQgY29udGVudEVsZW1lbnQgPSBudWxsO1xuICAgICAgICBsZXQgaXRlbXMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vYmplY3REYXRhICYmICFtYW55d2hvLnV0aWxzLmlzUGxhY2Vob2xkZXJPYmplY3REYXRhKHRoaXMucHJvcHMub2JqZWN0RGF0YSkpIHtcbiAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5wcm9wcy5vYmplY3REYXRhLm1hcChpdGVtID0+IGl0ZW0pO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5wYWdlID4gMSlcbiAgICAgICAgICAgICAgICBpdGVtcy51bnNoaWZ0KHsgdHlwZTogJ3ByZXYnIH0pO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5oYXNNb3JlUmVzdWx0cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgICAgICBpdGVtcyA9IGl0ZW1zLmNvbmNhdChbeyB0eXBlOiAnbmV4dCcgfV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuY29udGVudEVsZW1lbnQpXG4gICAgICAgICAgICBjb250ZW50RWxlbWVudCA9IHRoaXMucHJvcHMuY29udGVudEVsZW1lbnQ7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29udGVudEVsZW1lbnQgPSAoPGRpdiBjbGFzc05hbWU9XCJtdy10aWxlcy1pdGVtc1wiPlxuICAgICAgICAgICAgICAgIHtpdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleTogc3RyaW5nID0gYCR7dGhpcy5wcm9wcy5wYWdlLnRvU3RyaW5nKCl9LSR7aW5kZXh9YDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDxkaXYgY2xhc3NOYW1lPVwibXctdGlsZXMtaXRlbS1jb250YWluZXJcIiBrZXk9e2tleX0gcmVmPVwiaXRlbXNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxSZWFjdE1vdGlvbi5Nb3Rpb24gZGVmYXVsdFN0eWxlPXt7IHJvdGF0ZTogMH19IHN0eWxlPXt7IHJvdGF0ZTogUmVhY3RNb3Rpb24uc3ByaW5nKDE4MCwgeyBzdGlmZm5lc3M6IDY1LCBkYW1waW5nOiA5LjUgfSkgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge2ludGVycG9sYXRpbmdTdHlsZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZyb250VHJhbnNmb3JtIDogc3RyaW5nID0gYHJvdGF0ZVkoJHtpbnRlcnBvbGF0aW5nU3R5bGUucm90YXRlfWRlZylgO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWNrVHJhbnNmb3JtIDogc3RyaW5nID0gYHJvdGF0ZVkoJHsxODAgLSBpbnRlcnBvbGF0aW5nU3R5bGUucm90YXRlfWRlZylgO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZnJvbnRcIiBzdHlsZT17eyB0cmFuc2Zvcm06IGZyb250VHJhbnNmb3JtIH19PjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJiYWNrXCIgc3R5bGU9e3sgdHJhbnNmb3JtOiBiYWNrVHJhbnNmb3JtIH19Pnt0aGlzLnJlbmRlckl0ZW0oaXRlbSwgY29sdW1ucywgZm9vdGVyT3V0Y29tZXMsIGRlbGV0ZU91dGNvbWUpfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9SZWFjdE1vdGlvbi5Nb3Rpb24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PilcbiAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICA8L2Rpdj4pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICg8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBpZD17dGhpcy5wcm9wcy5pZH0gcmVmPVwiY29udGFpbmVyXCI+XG4gICAgICAgICAgICB7bGFiZWxFbGVtZW50fVxuICAgICAgICAgICAge2hlYWRlckVsZW1lbnR9XG4gICAgICAgICAgICB7Y29udGVudEVsZW1lbnR9XG4gICAgICAgICAgICB7UmVhY3QuY3JlYXRlRWxlbWVudChtYW55d2hvLmNvbXBvbmVudC5nZXRCeU5hbWUoJ3dhaXQnKSwgeyBpc1Zpc2libGU6IHN0YXRlLmxvYWRpbmcsIG1lc3NhZ2U6IHN0YXRlLmxvYWRpbmcgJiYgc3RhdGUubG9hZGluZy5tZXNzYWdlIH0sIG51bGwpfVxuICAgICAgICA8L2Rpdj4pO1xuICAgIH1cblxufVxuXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3Rlckl0ZW1zKCdwYW5lbHMnLCBQYW5lbHMpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
